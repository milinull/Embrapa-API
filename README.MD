# ğŸ‡ Embrapa Wine Data Analytics Platform

<div align="center">

![Python](https://img.shields.io/badge/python-3.12-blue)
![Django](https://img.shields.io/badge/Django-REST%20Framework-success)
![MongoDB](https://img.shields.io/badge/Database-MongoDB-green)
![Apache Spark](https://img.shields.io/badge/BigData-Apache%20Spark-orange)
![React](https://img.shields.io/badge/Frontend-React-61DAFB)
![Docker](https://img.shields.io/badge/Container-Docker-blue)
![AWS S3](https://img.shields.io/badge/Storage-AWS_S3-FF9900)

**Plataforma completa de anÃ¡lise de dados da indÃºstria vinÃ­cola brasileira**

[VisÃ£o Geral](#-visÃ£o-geral) â€¢ [Arquitetura](#ï¸-arquitetura) â€¢ [InstalaÃ§Ã£o](#-instalaÃ§Ã£o-rÃ¡pida) â€¢ [DocumentaÃ§Ã£o](#-documentaÃ§Ã£o-da-api) â€¢ [Tecnologias](#-stack-tecnolÃ³gico)

</div>

---

## ğŸ“‹ VisÃ£o Geral

Pipeline end-to-end de engenharia de dados que coleta, processa e visualiza informaÃ§Ãµes sobre a **produÃ§Ã£o, comercializaÃ§Ã£o, exportaÃ§Ã£o e importaÃ§Ã£o de vinhos no Brasil**, utilizando dados pÃºblicos da **Embrapa Uva & Vinho**.

### âœ¨ Principais Funcionalidades

- ğŸ”„ **ETL automatizado** com Apache Spark e armazenamento em camadas (Bronze/Silver)
- ğŸ“Š **Dashboard interativo** com visualizaÃ§Ãµes dinÃ¢micas e filtros avanÃ§ados
- ğŸš€ **API RESTful** escalÃ¡vel com Django e MongoDB
- ğŸ³ **Infraestrutura containerizada** com Docker Compose
- â˜ï¸ **IntegraÃ§Ã£o com AWS S3** para data lake
- ğŸ“ˆ **AnÃ¡lises comparativas** de produÃ§Ã£o vs exportaÃ§Ã£o

---

## ğŸ—ï¸ Arquitetura

```mermaid
graph TD
    subgraph Cloud["â˜ï¸ AWS S3 Data Lake"]
        A1[ğŸ“¦ Bronze Layer<br/>Raw Data]
        A2[âœ¨ Silver Layer<br/>Cleaned Data]
    end

    subgraph Spark["âš™ï¸ Apache Spark ETL"]
        B1[ğŸ•·ï¸ Web Scraping<br/>Embrapa Source]
        B2[ğŸ”§ Data Transformation<br/>Cleaning & Typing]
        B3[ğŸ’¾ MongoDB Loader<br/>Batch Insert]
    end

    subgraph Backend["ğŸ”Œ Django REST API"]
        C1[ğŸ¯ REST Endpoints<br/>MongoEngine ORM]
        C2[ğŸ” Authentication]
    end

    subgraph Frontend["ğŸ’» React Dashboard"]
        D1[ğŸ“Š Recharts Visualizations]
        D2[ğŸ¨ Interactive Filters]
    end

    subgraph Database["ğŸ—„ï¸ MongoDB Cluster"]
        E1[ğŸ“š Collections<br/>Wine Data]
        E2[ğŸ–¥ï¸ Mongo Express<br/>Admin UI]
    end

    B1 -->|Extract| A1
    A1 -->|Transform| B2
    B2 -->|Load| A2
    A2 -->|Read| B3
    B3 -->|Insert| E1
    E1 <-->|Query| C1
    C1 <-->|REST API| D1
    E2 -.->|Monitor| E1
```

---

## ğŸ³ ServiÃ§os Docker

| ServiÃ§o | DescriÃ§Ã£o | Portas | URL de Acesso |
|---------|-----------|--------|---------------|
| **web** | Django REST API | `8000` | http://localhost:8000/api |
| **mongo** | MongoDB Database | `27017` | - |
| **mongo-express** | MongoDB Admin UI | `8081` | http://localhost:8081 |
| **spark-master** | Spark + Jupyter Notebook | `8889`, `8083`, `8040`, `7077` | http://localhost:8889 |
| **wine-frontend** | React Dashboard | `3000` | http://localhost:3000 |

---

## ğŸš€ InstalaÃ§Ã£o RÃ¡pida

### PrÃ©-requisitos

- Docker 20.10+
- Docker Compose 2.0+
- Conta AWS (para S3)

### 1. Clone o repositÃ³rio

```bash
git clone https://github.com/seu-usuario/embrapa-wine-data.git
cd embrapa-wine-data
```

### 2. Configure as variÃ¡veis de ambiente

Crie um arquivo `.env` na raiz do projeto:

```bash
# Django Settings
DEBUG=True
SECRET_KEY=your-secret-key-here

# MongoDB Configuration
MDB_HOST=mongo
MDB_PORT=27017
MDB_USER=admin
MDB_PASS=admin123
MDB_NAME=embrapa_wine

# AWS S3 Configuration
AWS_ACCESS_KEY=your-access-key
AWS_SECRET_KEY=your-secret-key
AWS_DESTINY=your-bucket-name
AWS_DESTINY_KEY=your-bucket-name
AWS_LOCAL=us-east-1
```

### 3. Execute a aplicaÃ§Ã£o

```bash
docker compose up --build
```

Aguarde alguns minutos enquanto os containers sÃ£o construÃ­dos e inicializados.

### 4. Acesse as aplicaÃ§Ãµes

| AplicaÃ§Ã£o | URL | Credenciais |
|-----------|-----|-------------|
| Dashboard | http://localhost:3000 | - |
| API Django | http://localhost:8000/api | - |
| Mongo Express | http://localhost:8081 | admin / admin123 |
| Jupyter Notebook | http://localhost:8889 | Token exibido no log |

---

## ğŸ“Š Dashboard Interativo

O dashboard React oferece anÃ¡lises visuais completas com:

### Funcionalidades

- **ğŸ“ˆ MÃºltiplas visualizaÃ§Ãµes**: GrÃ¡ficos de barras, pizza e linhas temporais
- **ğŸ” Filtros dinÃ¢micos**: Por ano, categoria e paÃ­s
- **ğŸ“‘ Sistema de abas**: ComercializaÃ§Ã£o, ProduÃ§Ã£o, ExportaÃ§Ã£o, ImportaÃ§Ã£o e Processamento
- **ğŸ’¹ Comparativos**: AnÃ¡lise de produÃ§Ã£o vs exportaÃ§Ã£o
- **ğŸ“± Responsivo**: Interface adaptÃ¡vel para mobile e desktop

### Capturas de Tela



---

## ğŸ”„ Pipeline ETL

### Fluxo de Dados

```
1. EXTRAÃ‡ÃƒO â†’ Web scraping da Embrapa (BeautifulSoup)
                â†“
2. BRONZE LAYER â†’ Dados brutos salvos no S3
                â†“
3. TRANSFORMAÃ‡ÃƒO â†’ Limpeza e tipagem com Spark
                â†“
4. SILVER LAYER â†’ Dados processados no S3
                â†“
5. CARGA â†’ InserÃ§Ã£o em batch no MongoDB
```

### Notebooks Spark

1. **`scrap_embrapa.ipynb`** - ExtraÃ§Ã£o de dados
   - Web scraping das pÃ¡ginas da Embrapa
   - Parsing de tabelas HTML
   - Upload para S3 (bronze layer)

2. **`spark_transform.ipynb`** - TransformaÃ§Ã£o
   - Limpeza de caracteres especiais
   - ConversÃ£o de tipos de dados
   - ValidaÃ§Ã£o e normalizaÃ§Ã£o
   - GeraÃ§Ã£o da silver layer

3. **`MongoDBLoaderFromS3.py`** - Carga
   - Leitura batch do S3
   - InserÃ§Ã£o otimizada no MongoDB
   - Logging e tratamento de erros

---

## ğŸ“¡ DocumentaÃ§Ã£o da API

### Endpoints DisponÃ­veis

#### ComercializaÃ§Ã£o
```http
GET /api/Comercio/?ano=2024
```
Retorna dados de comercializaÃ§Ã£o de vinhos no mercado interno.

#### ProduÃ§Ã£o
```http
GET /api/Producao/?ano=2024
```
Dados de produÃ§Ã£o de vinhos e derivados.

#### ExportaÃ§Ã£o
```http
GET /api/Exportacao/?ano=2024&pais=Italia
```
Volume e valor de exportaÃ§Ãµes por paÃ­s de destino.

#### ImportaÃ§Ã£o
```http
GET /api/Importacao/?ano=2024&pais=Argentina
```
Volume e valor de importaÃ§Ãµes por paÃ­s de origem.

#### Processamento
```http
GET /api/Processamento/?ano=2024
```
Quantidade de uvas processadas por variedade.

#### Comparativo
```http
GET /api/comparativo/2024/
```
AnÃ¡lise comparativa entre produÃ§Ã£o e exportaÃ§Ã£o.

### Exemplo de Resposta

```json
{
  "ano": 2024,
  "data": [
    {
      "produto": "Vinho de Mesa",
      "quantidade": 125000000,
      "valor": 450000000
    }
  ],
  "total_registros": 15
}
```

---

## ğŸ› ï¸ Stack TecnolÃ³gico

### Backend
- **Django 5.2+** - Framework web
- **Django REST Framework** - API RESTful
- **MongoEngine** - ODM para MongoDB
- **python-decouple** - Gerenciamento de variÃ¡veis

### Big Data & ETL
- **Apache Spark 3.5** - Processamento distribuÃ­do
- **PySpark** - Interface Python para Spark
- **boto3** - SDK AWS para Python
- **BeautifulSoup4** - Web scraping

### Database
- **MongoDB 8.2** - Banco de dados NoSQL
- **PyMongo** - Driver Python para MongoDB

### Frontend
- **React** - Biblioteca UI
- **Recharts** - Biblioteca de grÃ¡ficos
- **Lucide React** - Ãcones
- **Axios** - Cliente HTTP

### Infraestrutura
- **Docker & Docker Compose** - ContainerizaÃ§Ã£o
- **AWS S3** - Object storage (Data Lake)

---

## ğŸ“ Estrutura do Projeto

```
embrapa-wine-data/
â”œâ”€â”€ ğŸ“‚ embrapa/                    # App Django principal
â”‚   â”œâ”€â”€ models.py                  # Models MongoEngine
â”‚   â”œâ”€â”€ views.py                   # ViewSets da API
â”‚   â”œâ”€â”€ serializers.py             # Serializadores DRF
â”‚   â””â”€â”€ urls.py                    # Rotas da API
â”œâ”€â”€ ğŸ“‚ mongo/                      # ConfiguraÃ§Ã£o MongoDB
â”‚   â”œâ”€â”€ connection.py              # Setup de conexÃ£o
â”‚   â””â”€â”€ MongoDBLoaderFromS3.py     # Carga
â”œâ”€â”€ ğŸ“‚ src/spark/spark-apps/       # Pipeline ETL
â”‚   â”œâ”€â”€ scrap_embrapa.ipynb        # ExtraÃ§Ã£o
â”‚   â””â”€â”€ spark_transform.ipynb      # TransformaÃ§Ã£o
â”œâ”€â”€ ğŸ“‚ wine-frontend/              # AplicaÃ§Ã£o React
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ public/                # Componentes React
â”‚   â”‚   â””â”€â”€ src/                   # Componente principal
â”œâ”€â”€ ğŸ“‚ setup/                      # ConfiguraÃ§Ãµes Django
â”‚   â”œâ”€â”€ settings.py
â”‚   â””â”€â”€ urls.py
â”œâ”€â”€ ğŸ“„ docker-compose.yml          # OrquestraÃ§Ã£o
â”œâ”€â”€ ğŸ“„ Dockerfile                  # Build Django
â”œâ”€â”€ ğŸ“„ requirements.txt            # DependÃªncias Python
â”œâ”€â”€ ğŸ“„ .env                        # Template de variÃ¡veis
â””â”€â”€ ğŸ“„ README.md                   # Este arquivo
```

---

## ğŸ§ª Desenvolvimento

### Executar Django localmente

```bash
# Criar ambiente virtual
python -m venv venv
source venv/bin/activate  # Linux/Mac
# ou
venv\Scripts\activate  # Windows

# Instalar dependÃªncias
pip install -r requirements.txt

# Executar servidor
python manage.py runserver
```

### Executar Frontend localmente

```bash
cd wine-frontend
npm install
npm start
```

### Acessar Jupyter Notebooks

```bash
# O token estÃ¡ nos logs do container
docker compose logs spark-master | grep token

# Acesse http://localhost:8889 e insira o token
```

### Executar testes

```bash
# Backend
python manage.py test

# Frontend
cd wine-frontend
npm test
```

---