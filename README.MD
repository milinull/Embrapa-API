
# üçá Embrapa Wine Data ‚Äî Django + Spark + MongoDB + React + Docker

![Python](https://img.shields.io/badge/python-3.12-blue)
![Django](https://img.shields.io/badge/Django-REST%20Framework-success)
![AWS S3](https://img.shields.io/badge/Storage-AWS_S3-success)
![MongoDB](https://img.shields.io/badge/Database-MongoDB-green)
![Apache Spark](https://img.shields.io/badge/BigData-Apache%20Spark-orange)
![Docker](https://img.shields.io/badge/Container-Docker-blue)

## üß© Vis√£o Geral

Este projeto cria um **pipeline completo de dados** que coleta, transforma, armazena e disponibiliza informa√ß√µes sobre a **produ√ß√£o, comercializa√ß√£o, exporta√ß√£o e importa√ß√£o de vinhos no Brasil**, baseadas nos dados p√∫blicos da **Embrapa Uva & Vinho**.

A aplica√ß√£o √© composta por 4 principais camadas:

1. **ETL (Spark + S3 + MongoDB)** ‚Üí Coleta e processamento dos dados.
2. **API (Django REST Framework + MongoEngine)** ‚Üí Exposi√ß√£o dos dados em endpoints REST.
3. **Frontend (React + Recharts)** ‚Üí Dashboard interativo com filtros e gr√°ficos.
4. **Infraestrutura (Docker Compose)** ‚Üí Orquestra√ß√£o dos servi√ßos.

---

## üèóÔ∏è Arquitetura do Sistema

```mermaid
graph TD
    subgraph Cloud["‚òÅÔ∏è AWS S3"]
        A1[Bronze Layer]
        A2[Silver Layer]
    end

    subgraph Spark["‚öôÔ∏è Apache Spark (ETL)"]
        B1[Scraping]
        B2[Transforma√ß√µes]
        B3[Envio ao MongoDB]
    end

    subgraph Backend["üß© Django API"]
        C1[Django REST + MongoEngine]
    end

    subgraph Frontend["üíª React Dashboard"]
        D1[Recharts + Lucide UI]
    end

    subgraph DB["üçÉ MongoDB"]
        E1[Collections]
        E2[Mongo Express GUI]
    end

    A1 -->|Leitura & Limpeza| B1
    B2 -->|Grava Silver| A2
    A2 -->|Carregamento| B3
    B3 -->|Insert Many| E1
    E1 -->|Query| C1
    C1 -->|API REST| D1
    D1 -->|Fetch/Axios| C1
    E2 -. visualiza .-> E1
```

---

## ‚öôÔ∏è Servi√ßos no Docker

| Servi√ßo           | Descri√ß√£o                         | Porta                          |
| ----------------- | --------------------------------- | ------------------------------ |
| **web**           | API Django (Backend)              | `8000`                         |
| **mongo**         | Banco de dados MongoDB            | `27017`                        |
| **mongo-express** | GUI web para o MongoDB            | `8081`                         |
| **spark-master**  | Ambiente Spark + Jupyter Notebook | `8889`, `8083`, `8040`, `7077` |
| **wine-frontend** | Dashboard React                   | `3000`                         |

---

## üß† Principais Tecnologias

* **Backend:** Django REST Framework + MongoEngine
* **Banco de Dados:** MongoDB
* **ETL / Big Data:** Apache Spark (PySpark)
* **Cloud:** Amazon S3
* **Frontend:** React + Recharts + Lucide Icons
* **Infraestrutura:** Docker & Docker Compose
* **Autentica√ß√£o de vari√°veis:** `python-decouple`

---

## üöÄ Como Executar o Projeto

### 1Ô∏è‚É£ Clonar o reposit√≥rio

```bash
git clone https://github.com/seu-usuario/embrapa-wine-data.git
cd embrapa-wine-data
```

### 2Ô∏è‚É£ Configurar vari√°veis de ambiente

Crie um arquivo `.env` na raiz do projeto com as vari√°veis abaixo:

```bash
DEBUG=True
MDB_HOST=mongo
MDB_PORT=27017
MDB_USER=admin
MDB_PASS=admin123
MDB_NAME=embrapa_wine

AWS_ACCESS_KEY=SUACHAVE
AWS_SECRET_KEY=SUASECRET
AWS_DESTINY=seu-bucket
AWS_DESTINY_KEY=seu-bucket
AWS_LOCAL=us-east-1
```

### 3Ô∏è‚É£ Subir os containers

```bash
docker compose up --build
```

A aplica√ß√£o estar√° dispon√≠vel em:

* Django API ‚Üí [http://localhost:8000/api](http://localhost:8000/api/)
* Mongo Express ‚Üí [http://localhost:8081](http://localhost:8081)
* Spark Jupyter ‚Üí [http://localhost:8889](http://localhost:8889)
* Dashboard React ‚Üí [http://localhost:3000](http://localhost:3000)

---

## üìä Frontend ‚Äî Dashboard de Vinhos

O frontend React exibe um **painel interativo** com abas e filtros para:

* Comercializa√ß√£o
* Produ√ß√£o
* Exporta√ß√£o
* Importa√ß√£o
* Processamento de uvas

As visualiza√ß√µes utilizam **Recharts**, com gr√°ficos de barras e pizza, al√©m de indicadores de resumo e comparativo de produ√ß√£o/exporta√ß√£o.

---

## üîÑ ETL com Spark

O pipeline Spark realiza:

1. **Scraping dos dados da Embrapa** (`scrap_embrapa.ipynb`)

   * Faz requests HTML
   * Extrai tabelas via BeautifulSoup
   * Converte e envia para o S3 (camada *bronze*)

2. **Transforma√ß√£o e limpeza dos dados** (`spark_transform.ipynb`)

   * Limpeza de colunas e caracteres corrompidos
   * Convers√£o de tipos (string ‚Üí num√©rico)
   * Gera√ß√£o da camada *silver* no S3
   * Envio final para o **MongoDB**

3. **Carga automatizada no MongoDB**

   * Via `MongoDBLoaderFromS3.py` usando batches Spark + PyMongo.

---

## üì° API Endpoints (principais)

| Endpoint                       | Descri√ß√£o                               |
| ------------------------------ | --------------------------------------- |
| `/api/Comercio/?ano=2024`      | Dados de comercializa√ß√£o                |
| `/api/Producao/?ano=2024`      | Produ√ß√£o de vinhos                      |
| `/api/Exportacao/?ano=2024`    | Exporta√ß√µes por pa√≠s                    |
| `/api/Importacao/?ano=2024`    | Importa√ß√µes por pa√≠s                    |
| `/api/Processamento/?ano=2024` | Processamento de uvas                   |
| `/api/comparativo/<ano>/`      | Comparativo entre produ√ß√£o e exporta√ß√£o |

---

## üß∞ Estrutura de Pastas

```
üì¶ embrapa-wine-data
‚îú‚îÄ‚îÄ embrapa/                 # App principal Django (models, views, serializers)
‚îú‚îÄ‚îÄ mongo/                   # Conex√£o e loaders do MongoDB
‚îú‚îÄ‚îÄ src/spark/spark-apps/    # Notebooks ETL com Spark e S3
‚îú‚îÄ‚îÄ wine-frontend/           # Aplica√ß√£o React com Recharts
‚îú‚îÄ‚îÄ setup/                   # Configura√ß√µes Django
‚îú‚îÄ‚îÄ Dockerfile               # Build da API Django
‚îú‚îÄ‚îÄ docker-compose.yml       # Orquestra√ß√£o dos servi√ßos
‚îú‚îÄ‚îÄ requirements.txt
‚îî‚îÄ‚îÄ .env
```

---

## üß™ Testes e Desenvolvimento

Rodar Django localmente (sem Docker):

```bash
python manage.py runserver
```

Rodar o frontend:

```bash
cd wine-frontend
npm install
npm start
```

Executar os notebooks Spark no container:

```bash
http://localhost:8889
```

---
